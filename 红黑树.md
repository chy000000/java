## 红黑树

红黑树是一种自平衡的二叉查找树，除了二叉查找树的基本特性外，还有以下特性：

1. 结点是红色或黑色。

2. 根结点是黑色。

3. 每个叶子结点都是黑色的空结点（NIL结点）。

4. 每个红色结点的两个子结点都是黑色。(从每个叶子到根的所有路径上不能有两个连续的红色结点)

5. 从任一结点到其每个叶子的所有路径都包含相同数目的黑色结点。

![image-20210203220306831](C:\Users\chy\Desktop\研究生相关信息\学习\计算机网络\img\image-20210203220306831.png)

红黑树的调整方法有两种：变色和旋转

1. 变色：

   为了重新符合红黑树的规则，尝试把红色结点变为黑色，或者把黑色结点变为红色。

   下图所表示的是红黑树的一部分（子树），新插入的结点Y是红色结点，它的父亲结点X也是红色的，不符合规则4，因此我们可以把结点X从红色变成黑色：

   ![image-20210203220425354](C:\Users\chy\Desktop\研究生相关信息\学习\计算机网络\img\image-20210203220425354.png)

   但是，仅仅把一个结点变色，会导致相关路径凭空多出一个黑色结点，这样就打破了规则5。因此，我们需要对其他结点做进一步的调整

2. 旋转：

   * 左旋转

     **逆时针**旋转红黑树的两个结点，使得父结点被自己的右孩子取代，而自己成为自己的左孩子。说起来很怪异，大家看下图：

     ![image-20210203220508437](C:\Users\chy\Desktop\研究生相关信息\学习\计算机网络\img\image-20210203220508437.png)

     图中，身为右孩子的Y取代了X的位置，而X变成了自己的左孩子。此为左旋转。

   * 右旋转

     **顺时针**旋转红黑树的两个结点，使得父结点被自己的左孩子取代，而自己成为自己的右孩子。大家看下图：

     ![image-20210203220543059](C:\Users\chy\Desktop\研究生相关信息\学习\计算机网络\img\image-20210203220543059.png)

在进行调整时，红黑树的调整可分为5种不同的局面

**局面1：**新结点（A）位于树根，没有父结点。

![image-20210203220631318](C:\Users\chy\Desktop\研究生相关信息\学习\计算机网络\img\image-20210203220631318.png)

这种局面，直接让新结点变色为黑色，规则2得到满足。同时，黑色的根结点使得每条路径上的黑色结点数目都增加了1，所以并没有打破规则5。

![image-20210203220644568](C:\Users\chy\Desktop\研究生相关信息\学习\计算机网络\img\image-20210203220644568.png)

**局面2：**新结点（B）的父结点是黑色。

这种局面，新插入的红色结点B并没有打破红黑树的规则，所以不需要做任何调整。

![image-20210203220706950](C:\Users\chy\Desktop\研究生相关信息\学习\计算机网络\img\image-20210203220706950.png)

**局面3：**新结点（D）的父结点和叔叔结点都是红色。

![image-20210203220723867](C:\Users\chy\Desktop\研究生相关信息\学习\计算机网络\img\image-20210203220723867.png)

这种局面，两个红色结点B和D连续，违反了规则4。因此我们先让结点B变为黑色：

![image-20210203220746048](C:\Users\chy\Desktop\研究生相关信息\学习\计算机网络\img\image-20210203220746048.png)

这样一来，结点B所在路径凭空多了一个黑色结点，打破了规则5。因此我们让结点A变为红色：

![image-20210203220816270](C:\Users\chy\Desktop\研究生相关信息\学习\计算机网络\img\image-20210203220816270.png)

这时候，结点A和C又成为了连续的红色结点，我们再让结点C变为黑色：

![image-20210203220833201](C:\Users\chy\Desktop\研究生相关信息\学习\计算机网络\img\image-20210203220833201.png)

经过上面的调整，这一局部重新符合了红黑树的规则。

**局面4：**新结点（D）的父结点是红色，叔叔结点是黑色或者没有叔叔，且新结点是父结点的右孩子，父结点（B）是祖父结点的左孩子。

![image-20210203220855330](C:\Users\chy\Desktop\研究生相关信息\学习\计算机网络\img\image-20210203220855330.png)

我们以结点B为轴，做一次左旋转，使得新结点D成为父结点，原来的父结点B成为D的左孩子：

![image-20210203220941676](C:\Users\chy\Desktop\研究生相关信息\学习\计算机网络\img\image-20210203220941676.png)

这样一来，进入了局面5。

**局面5：**新结点（D）的父结点是红色，叔叔结点是黑色或者没有叔叔，且新结点是父结点的左孩子，父结点（B）是祖父结点的左孩子。

![image-20210203220957849](C:\Users\chy\Desktop\研究生相关信息\学习\计算机网络\img\image-20210203220957849.png)

我们以结点A为轴，做一次右旋转，使得结点B成为祖父结点，结点A成为结点B的右孩子:

![image-20210203221011214](C:\Users\chy\Desktop\研究生相关信息\学习\计算机网络\img\image-20210203221011214.png)

接下来，我们让结点B变为黑色，结点A变为红色：

![image-20210203221023976](C:\Users\chy\Desktop\研究生相关信息\学习\计算机网络\img\image-20210203221023976.png)

经过上面的调整，这一局部重新符合了红黑树的规则。

> 二叉查找树是如何进行删除操作的呢？可以分成三种情况。

**情况1，待删除的结点没有子结点：**

![image-20210203223012995](C:\Users\chy\Desktop\研究生相关信息\学习\计算机网络\img\image-20210203223012995.png)

上图中，待删除的结点12是叶子结点，没有孩子，因此直接删除即可：

**情况2，待删除的结点有一个孩子：**

![image-20210203223033945](C:\Users\chy\Desktop\研究生相关信息\学习\计算机网络\img\image-20210203223033945.png)

上图中，待删除的结点13只有左孩子，于是我们让左孩子结点11取代被删除的结点，结点11以下的结点关系无需变动：

![image-20210203223047317](C:\Users\chy\Desktop\研究生相关信息\学习\计算机网络\img\image-20210203223047317.png)

**情况3，待删除的结点有两个孩子：**

![image-20210203223112189](C:\Users\chy\Desktop\研究生相关信息\学习\计算机网络\img\image-20210203223112189.png)

上图中，待删除的结点5有两个孩子，这种情况比较复杂。此时，我们需要选择与待删除结点最接近的结点来取代它。

上面的例子中，结点3仅小于结点5，结点6仅大于结点5，两者都是合适的选择。但习惯上我们选择仅大于待删除结点的结点，也就是结点6来取代它。

于是我们复制结点6到原来结点5的位置：

![image-20210203223128633](C:\Users\chy\Desktop\研究生相关信息\学习\计算机网络\img\image-20210203223128633.png)

被选中的结点6，仅大于结点5，因此一定没有左孩子。所以我们按照情况1或情况2的方式，删除多余的结点6:

![image-20210203223139897](C:\Users\chy\Desktop\研究生相关信息\学习\计算机网络\img\image-20210203223139897.png)

> AVL树和红黑树的差别

AVL树是严格平衡的二叉树，要求每个节点的左右子树高度差不超过1，红黑树则要宽松一些，要求任何一条路径的长度不超过其他路径长度的两倍。

正因这个差别，AVL树的查找效率更高。在需要频繁查找是选用AVL树，频繁插入删除时，选用红黑树。